<form class="{{cssClass}}" autocomplete="off">
    <header class="sheet-header">
        <img class="profile-img" src="{{item.img}}" data-edit="img" title="{{item.name}}" />
        <div class="header-fields">
            <h1 class="charname"><input name="name" type="text" value="{{item.name}}" placeholder="Name" required /></h1>
            <div>
                <label class="resource-label">{{localize "Ex3.Ability"}}: </label>
                <select name="system.ability" data-type="String">
                    {{#each charmAbilityListSectioned as |charmCategory charmCategoryType|}}
                    <optgroup label="{{localize charmCategory.label}}">
                        {{selectOptions charmCategory.entries selected=../system.ability localize=true}}
                    </optgroup>
                    {{/each}}
                </select>
                <select name="system.requirement" data-type="String">
                    {{selectOptions selects.abilityRequirementLevels selected=system.requirement localize=false}}
                </select>
                <label class="resource-label">{{localize "Ex3.Essence"}}: </label>
                <select name="system.essence" data-type="String">
                    {{selectOptions selects.essenceLevels selected=system.essence localize=false}}
                </select>
            </div>
        </div>
    </header>

    <nav class="sheet-tabs tabs" data-group="primary">
        <a class="item" data-tab="description">{{localize "Ex3.Description"}}</a>
        <a class="item" data-tab="costs">{{localize "Ex3.Costs"}}</a>
        <a class="item" data-tab="bonuses">{{localize "Ex3.Dice"}}</a>
        <a class="item" data-tab="automations">{{localize "Ex3.Automations"}}</a>
        <a class="item" data-tab="upgrades">{{localize "Ex3.Upgrades"}}</a>
        <a class="item" data-tab="other">{{localize "Ex3.Other"}}</a>
    </nav>

    {{!-- Sheet Body --}}
    <section class="sheet-body">

        {{!-- Description Tab --}}
        <div class="tab" data-group="primary" data-tab="description">
            <div class="grid grid-2col flex-group-center">
                <div>
                    <div class="resource-label">{{localize "Ex3.Type"}}</div>
                    <input type="text" name="system.type" value="{{system.type}}" />
                </div>
                <div>
                    <div class="resource-label">{{localize "Ex3.Duration"}}</div>
                    <input type="text" name="system.duration" value="{{system.duration}}" />
                </div>
            </div>
            <div class="flex-center mt-1">
                <div class="resource-label">{{localize "Ex3.Keywords"}} <a><i
                            class="fas fa-info-circle charms-cheat-sheet cursor-pointer"></i></a></div>
            </div>
            <input type="text" name="system.keywords" value="{{system.keywords}}" />
            <div class="flex-center mt-1">
                <div class="resource-label">{{localize "Ex3.CharmPrerequisites"}}</div>
            </div>
            <div class="embeded-item-list-wrapper" {{#if
                options.editable}}style="border: 1px solid var(--color-border-light-tertiary);" {{/if}}>
                <div class="flex-group-center embeded-item-list">
                    <ul>
                        {{#if options.editable}}
                        {{#each system.charmprerequisites as |item id|}}
                        <a draggable="true" class="embeded-item-pill" data-id="{{item.id}}"
                            data-item-name="{{item.name}}" data-item-index="{{id}}">
                            <li data-item-index="{{id}}">
                                {{item.name}}{{#ifGreater item.count 1}}x{{item.count}}{{/ifGreater}}
                                <i class="fas fa-trash embeded-item-delete"></i>
                            </li>
                        </a>
                        {{/each}}
                        {{else}}
                        {{#each system.charmprerequisites as |item id|}}
                        <li class="embeded-item-pill" data-item-name="{{../name}}" data-item-index="{{id}}">
                            {{item.name}}{{#ifGreater item.count 1}}x{{item.count}}{{/ifGreater}}
                        </li>
                        {{/each}}
                        {{/if}}
                    </ul>
                </div>
            </div>
            <div class="flex-center mt-1">
                <div class="resource-label">{{localize "Ex3.OtherPrerequisites"}}</div>
            </div>
            <input class="mb-1" type="text" name="system.prerequisites" value="{{system.prerequisites}}" />
            <div class="flex-center">
                <div class="resource-label">{{localize "Ex3.Description"}}</div>
            </div>
            {{editor descriptionHTML target="system.description" button=true editable=editable engine="prosemirror"}}
        </div>

        <div class="tab" data-group="primary" data-tab="costs">
            <div class="d-flex flex-center resources">
                <div>
                    <div class="resource-label">{{localize "Ex3.Motes"}}</div>
                    <input type="number" name="system.cost.motes" value="{{system.cost.motes}}" data-dtype="Number" />
                </div>
                <div>
                    <div class="resource-label">{{localize "Ex3.CommitM"}}</div>
                    <input type="number" name="system.cost.commitmotes" value="{{system.cost.commitmotes}}"
                        data-dtype="Number" />
                </div>
                <div>
                    <div class="resource-label">{{localize "Ex3.Initiative"}}</div>
                    <input type="number" name="system.cost.initiative" value="{{system.cost.initiative}}"
                        data-dtype="Number" />
                </div>
                <div>
                    <div class="resource-label">{{localize "Ex3.Anima"}}</div>
                    <input type="number" name="system.cost.anima" value="{{system.cost.anima}}" data-dtype="Number" />
                </div>
                <div>
                    <div class="resource-label">{{localize "Ex3.Willpower"}}</div>
                    <input type="number" name="system.cost.willpower" value="{{system.cost.willpower}}"
                        data-dtype="Number" />
                </div>
                <div>
                    <div class="resource-label">{{localize "Ex3.GrappleControl"}}</div>
                    <input type="number" name="system.cost.grapplecontrol" value="{{system.cost.grapplecontrol}}"
                        data-dtype="Number" />
                </div>
            </div>
            <div class="grid grid-5col flex-group-center">
                <div>
                    <div class="resource-label">{{localize "Ex3.Health"}}</div>
                    <input type="number" name="system.cost.health" value="{{system.cost.health}}" data-dtype="Number" />
                </div>
                <div>
                    <div class="resource-label">{{localize "Ex3.HealthType"}}</div>
                    <select name="system.cost.healthtype" data-type="String">
                        {{selectOptions selects.damageTypes selected=system.cost.healthtype localize=true}}
                    </select>
                </div>
                <div>
                    <div class="resource-label">{{localize "Ex3.Aura"}}</div>
                    <select name="system.cost.aura" data-type="String">
                        {{selectOptions selects.costElements selected=system.cost.aura localize=true}}
                    </select>
                </div>
                <div>
                    <div class="resource-label">{{localize "Ex3.XP"}}</div>
                    <input type="number" name="system.cost.xp" value="{{system.cost.xp}}" data-dtype="Number" />
                </div>
                <div>
                    <div class="resource-label">{{localize "Ex3.Penumbra"}}</div>
                    <input type="number" name="system.cost.penumbra" value="{{system.cost.penumbra}}"
                        data-dtype="Number" />
                </div>
            </div>
            <div class="flex-center">
                <div class="resource-label">{{localize "Ex3.Craft"}} {{localize "Ex3.Cost"}}</div>
            </div>
            <div class="grid grid-3col flex-group-center">
                <div>
                    <div class="resource-label">{{localize "Ex3.Silver"}}</div>
                    <input type="number" name="system.cost.silverxp" value="{{system.cost.silverxp}}"
                        data-dtype="Number" />
                </div>
                <div>
                    <div class="resource-label">{{localize "Ex3.Gold"}}</div>
                    <input type="number" name="system.cost.goldxp" value="{{system.cost.goldxp}}" data-dtype="Number" />
                </div>
                <div>
                    <div class="resource-label">{{localize "Ex3.White"}}</div>
                    <input type="number" name="system.cost.whitexp" value="{{system.cost.whitexp}}"
                        data-dtype="Number" />
                </div>
            </div>
            <div class="flex-center">
                <div class="resource-label">{{localize "Ex3.Restore"}}</div>
            </div>
            <div class="grid grid-3col flex-group-center">
                <div>
                    <div class="resource-label">{{localize "Ex3.Motes"}}</div>
                    <input type="number" name="system.restore.motes" value="{{system.restore.motes}}"
                        data-dtype="Number" />
                </div>
                <div>
                    <div class="resource-label">{{localize "Ex3.Willpower"}}</div>
                    <input type="number" name="system.restore.willpower" value="{{system.restore.willpower}}"
                        data-dtype="Number" />
                </div>
                <div>
                    <div class="resource-label">{{localize "Ex3.Anima"}}</div>
                    <input type="number" name="system.restore.anima" value="{{system.restore.anima}}"
                        data-dtype="Number" />
                </div>
                <div>
                    <div class="resource-label">{{localize "Ex3.Health"}}</div>
                    <input type="number" name="system.restore.health" value="{{system.restore.health}}"
                        data-dtype="Number" />
                </div>
                <div>
                    <div class="resource-label">{{localize "Ex3.Initiative"}}</div>
                    <input type="number" name="system.restore.initiative" value="{{system.restore.initiative}}"
                        data-dtype="Number" />
                </div>
                <div>
                    <div class="resource-label">{{localize "Ex3.GrappleControl"}}</div>
                    <input type="number" name="system.restore.grapplecontrol" value="{{system.restore.grapplecontrol}}"
                        data-dtype="Number" />
                </div>
            </div>
        </div>

        <div class="tab" data-group="primary" data-tab="bonuses">
            <div class="resource flex-center mb-1" style="font-size: 17px;">
                <label class="resource-label">{{localize "Ex3.DiceRollModifiers"}} <a><i
                            class="formula-help fas fa-info-circle"></i></label></a></label>
            </div>
            <div class="d-flex flex-center resource-label">
                <div class="resource-label">{{localize "Ex3.DiceRollBonus"}}</div>
                <input name="system.diceroller.enabled" type="checkbox" {{checked system.diceroller.enabled}}>
            </div>
            <div>
                <div class="resource grid grid-3col flex-center">
                    <div>
                        <label class="resource-label"><a class="toggle-charm-dice"><i
                                    class="fa-solid fa-circle-check non-charm-dice" title="Toggle Non-Charm"></i></a>
                            {{localize "Ex3.DiceBonus"}}*</label>
                        <input name="system.diceroller.bonusdice" value="{{system.diceroller.bonusdice}}" type="text">
                    </div>
                    <div>
                        <label class="resource-label"><a class="toggle-charm-successes"><i
                                    class="fa-solid fa-circle-check non-charm-successes"
                                    title="Toggle Non-Charm"></i></a> {{localize "Ex3.SuccessBonus"}}*</label>
                        <input name="system.diceroller.bonussuccesses" value="{{system.diceroller.bonussuccesses}}"
                            type="text">
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.IgnorePenalties"}}*</label>
                        <input name="system.diceroller.ignorepenalties" value="{{system.diceroller.ignorepenalties}}"
                            type="text">
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.DecreaseTargetNumber"}}</label>
                        <input name="system.diceroller.decreasetargetnumber"
                            value="{{system.diceroller.decreasetargetnumber}}" type="number">
                    </div>

                    <div>
                        <label class="resource-label">{{localize "Ex3.DoubleSuccess"}} +</label>
                        <input name="system.diceroller.doublesuccess" value="{{system.diceroller.doublesuccess}}"
                            type="number">
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.RerollFailedDice"}}*</label>
                        <input name="system.diceroller.rerolldice" value="{{system.diceroller.rerolldice}}" type="text">
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.DicetoSuccesses"}}*</label>
                        <input name="system.diceroller.diceToSuccesses" value="{{system.diceroller.diceToSuccesses}}"
                            type="text">
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.ReduceDifficulty"}}*</label>
                        <input name="system.diceroller.reducedifficulty" value="{{system.diceroller.reducedifficulty}}"
                            type="text">
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.RerollAllFailedOnce"}}</label>
                        <div>
                            <input type="checkbox" name="system.diceroller.rerollfailed" {{checked
                                system.diceroller.rerollfailed}}>
                        </div>
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.RollTwiceKeepHighest"}}</label>
                        <div>
                            <input type="checkbox" name="system.diceroller.rolltwice" {{checked
                                system.diceroller.rolltwice}}>
                        </div>
                    </div>
                </div>
            </div>

            <div class="resource flex-center">
                <label class="resource-label">{{localize "Ex3.Reroll"}}</label>
            </div>
            <div class="resource d-flex flex-center">
                <div>
                    <div>1</div>
                    <input name="system.diceroller.reroll.one" type="checkbox" {{checked system.diceroller.reroll.one}}>
                </div>
                <div>
                    <div>2</div>
                    <input name="system.diceroller.reroll.two" type="checkbox" {{checked system.diceroller.reroll.two}}>
                </div>
                <div>
                    <div>3</div>
                    <input name="system.diceroller.reroll.three" type="checkbox" {{checked
                        system.diceroller.reroll.three}}>
                </div>
                <div>
                    <div>4</div>
                    <input name="system.diceroller.reroll.four" type="checkbox" {{checked
                        system.diceroller.reroll.four}}>
                </div>
                <div>
                    <div>5</div>
                    <input name="system.diceroller.reroll.five" type="checkbox" {{checked
                        system.diceroller.reroll.five}}>
                </div>
                <div>
                    <div>6</div>
                    <input name="system.diceroller.reroll.six" type="checkbox" {{checked system.diceroller.reroll.six}}>
                </div>
                <div>
                    <div>7</div>
                    <input name="system.diceroller.reroll.seven" type="checkbox" {{checked
                        system.diceroller.reroll.seven}}>
                </div>
                <div>
                    <div>8</div>
                    <input name="system.diceroller.reroll.eight" type="checkbox" {{checked
                        system.diceroller.reroll.eight}}>
                </div>
                <div>
                    <div>9</div>
                    <input name="system.diceroller.reroll.nine" type="checkbox" {{checked
                        system.diceroller.reroll.nine}}>
                </div>
                <div>
                    <div>10</div>
                    <input name="system.diceroller.reroll.ten" type="checkbox" {{checked system.diceroller.reroll.ten}}>
                </div>
            </div>
            <div class="resource flex-center">
                <label class="resource-label">{{localize "Ex3.RerollsCap"}}* <i
                        title="Effects 'Rerolls 6s' style rerolls, 0 means no cap"
                        class="fas fa-info-circle"></i></label>
            </div>
            <div class="resource d-flex flex-center mb-1">
                <div class="resource d-flex flex-center">
                    <div>
                        <div>1</div>
                        <input name="system.diceroller.rerollcap.one" value="{{system.diceroller.rerollcap.one}}"
                            type="text">
                    </div>
                    <div>
                        <div>2</div>
                        <input name="system.diceroller.rerollcap.two" value="{{system.diceroller.rerollcap.two}}"
                            type="text">
                    </div>
                    <div>
                        <div>3</div>
                        <input name="system.diceroller.rerollcap.three" value="{{system.diceroller.rerollcap.three}}"
                            type="text">
                    </div>
                    <div>
                        <div>4</div>
                        <input name="system.diceroller.rerollcap.four" value="{{system.diceroller.rerollcap.four}}"
                            type="text">
                    </div>
                    <div>
                        <div>5</div>
                        <input name="system.diceroller.rerollcap.five" value="{{system.diceroller.rerollcap.five}}"
                            type="text">
                    </div>
                    <div>
                        <div>6</div>
                        <input name="system.diceroller.rerollcap.six" value="{{system.diceroller.rerollcap.six}}"
                            type="text">
                    </div>
                    <div>
                        <div>7</div>
                        <input name="system.diceroller.rerollcap.seven" value="{{system.diceroller.rerollcap.seven}}"
                            type="text">
                    </div>
                    <div>
                        <div>8</div>
                        <input name="system.diceroller.rerollcap.eight" value="{{system.diceroller.rerollcap.eight}}"
                            type="text">
                    </div>
                    <div>
                        <div>9</div>
                        <input name="system.diceroller.rerollcap.nine" value="{{system.diceroller.rerollcap.nine}}"
                            type="text">
                    </div>
                    <div>
                        <div>10</div>
                        <input name="system.diceroller.rerollcap.ten" value="{{system.diceroller.rerollcap.ten}}"
                            type="text">
                    </div>
                </div>
            </div>
            <div class="resource flex-center">
                <label class="resource-label">{{localize "Ex3.DoubleSuccessCap"}}*</label>
            </div>
            <div class="resource grid grid-4col flex-center">
                <div>
                    <label class="resource-label">{{localize "Ex3.Sevens"}}</label>
                    <input name="system.diceroller.doublesucccesscaps.sevens"
                        value="{{system.diceroller.doublesucccesscaps.sevens}}" type="text">
                </div>
                <div>
                    <label class="resource-label">{{localize "Ex3.Eights"}}</label>
                    <input name="system.diceroller.doublesucccesscaps.eights"
                        value="{{system.diceroller.doublesucccesscaps.eights}}" type="text">
                </div>
                <div>
                    <label class="resource-label">{{localize "Ex3.Nines"}}</label>
                    <input name="system.diceroller.doublesucccesscaps.nines"
                        value="{{system.diceroller.doublesucccesscaps.nines}}" type="text">
                </div>
                <div>
                    <label class="resource-label">{{localize "Ex3.Tens"}}</label>
                    <input name="system.diceroller.doublesucccesscaps.tens"
                        value="{{system.diceroller.doublesucccesscaps.tens}}" type="text">
                </div>
            </div>
            <div class="resource grid grid-2col flex-center">
                <div>
                    <div class="resource-label">{{localize "Ex3.TriggerOnTens"}}</div>
                    <select name="system.diceroller.triggerontens" data-type="String">
                        {{selectOptions selects.triggerOnTensOptions selected=system.diceroller.triggerontens
                        localize=true}}
                    </select>
                </div>
                <div>
                    <div class="resource-label">{{localize "Ex3.TriggerTensCap"}}*</div>
                    <input name="system.diceroller.triggertenscap" value="{{system.diceroller.triggertenscap}}"
                        type="text">
                </div>
                <div>
                    <div class="resource-label">{{localize "Ex3.AlsoTriggerNines"}}</div>
                    <input name="system.diceroller.alsotriggernines" type="checkbox" {{checked
                        system.diceroller.alsotriggernines}}>
                </div>
                <div>
                    <div class="resource-label">{{localize "Ex3.ExcludeOnesFromRerolls"}}</div>
                    <input name="system.diceroller.excludeonesfromrerolls" type="checkbox" {{checked
                        system.diceroller.excludeonesfromrerolls}}>
                </div>
            </div>
            <div class="flex-center resource-label" style="font-weight: bold;font-size:17px;">
                {{localize "Ex3.Damage"}}
            </div>
            <div>
                <div class="resource grid grid-3col flex-center">
                    <div>
                        <label class="resource-label">{{localize "Ex3.DamageDice"}}*</label>
                        <input type="text" name="system.diceroller.damage.bonusdice"
                            value="{{system.diceroller.damage.bonusdice}}">
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.DamageSuccesses"}}*</label>
                        <input type="text" name="system.diceroller.damage.bonussuccesses"
                            value="{{system.diceroller.damage.bonussuccesses}}">
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.DoubleSuccess"}} + </label>
                        <input type="number" name="system.diceroller.damage.doublesuccess"
                            value="{{system.diceroller.damage.doublesuccess}}">
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.DecreaseTargetNumber"}} </label>
                        <input type="number" name="system.diceroller.damage.decreasetargetnumber"
                            value="{{system.diceroller.damage.decreasetargetnumber}}">
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.RerollFailedDice"}}*</label>
                        <input name="system.diceroller.damage.rerolldice"
                            value="{{system.diceroller.damage.rerolldice}}" type="text">
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.RerollAllFailedOnce"}} </label>
                        <div>
                            <input type="checkbox" name="system.diceroller.damage.rerollfailed" {{checked
                                system.diceroller.damage.rerollfailed}}>
                        </div>
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.RollTwiceKeepHighest"}} </label>
                        <div>
                            <input type="checkbox" name="system.diceroller.damage.rolltwice" {{checked
                                system.diceroller.damage.rolltwice}}>
                        </div>
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.Overwhelming"}}*</label>
                        <input type="text" name="system.diceroller.damage.overwhelming"
                            value="{{system.diceroller.damage.overwhelming}}">
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.PostSoakDamage"}}*</label>
                        <input type="text" name="system.diceroller.damage.postsoakdamage"
                            value="{{system.diceroller.damage.postsoakdamage}}">
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.IgnoreSoak"}}*</label>
                        <input type="text" name="system.diceroller.damage.ignoresoak"
                            value="{{system.diceroller.damage.ignoresoak}}">
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.IgnoreHardness"}}*</label>
                        <input type="text" name="system.diceroller.damage.ignorehardness"
                            value="{{system.diceroller.damage.ignorehardness}}">
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.DicetoSuccesses"}}*</label>
                        <input name="system.diceroller.damage.dicetosuccesses"
                            value="{{system.diceroller.damage.dicetosuccesses}}" type="text">
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.ThreshholdToDamage"}} </label>
                        <div>
                            <input type="checkbox" name="system.diceroller.damage.threshholdtodamage" {{checked
                                system.diceroller.damage.threshholdtodamage}}>
                        </div>
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.DoubleRolledDamage"}} </label>
                        <div>
                            <input type="checkbox" name="system.diceroller.damage.doublerolleddamage" {{checked
                                system.diceroller.damage.doublerolleddamage}}>
                        </div>
                    </div>
                </div>
                <div class="resource flex-center">
                    <label class="resource-label">{{localize "Ex3.Reroll"}}</label>
                </div>
                <div class="resource d-flex flex-center">
                    <div>
                        <div>1</div>
                        <input name="system.diceroller.damage.reroll.one" type="checkbox" {{checked
                            system.diceroller.damage.reroll.one}}>
                    </div>
                    <div>
                        <div>2</div>
                        <input name="system.diceroller.damage.reroll.two" type="checkbox" {{checked
                            system.diceroller.damage.reroll.two}}>
                    </div>
                    <div>
                        <div>3</div>
                        <input name="system.diceroller.damage.reroll.three" type="checkbox" {{checked
                            system.diceroller.damage.reroll.three}}>
                    </div>
                    <div>
                        <div>4</div>
                        <input name="system.diceroller.damage.reroll.four" type="checkbox" {{checked
                            system.diceroller.damage.reroll.four}}>
                    </div>
                    <div>
                        <div>5</div>
                        <input name="system.diceroller.damage.reroll.five" type="checkbox" {{checked
                            system.diceroller.damage.reroll.five}}>
                    </div>
                    <div>
                        <div>6</div>
                        <input name="system.diceroller.damage.reroll.six" type="checkbox" {{checked
                            system.diceroller.damage.reroll.six}}>
                    </div>
                    <div>
                        <div>7</div>
                        <input name="system.diceroller.damage.reroll.seven" type="checkbox" {{checked
                            system.diceroller.damage.reroll.seven}}>
                    </div>
                    <div>
                        <div>8</div>
                        <input name="system.diceroller.damage.reroll.eight" type="checkbox" {{checked
                            system.diceroller.damage.reroll.eight}}>
                    </div>
                    <div>
                        <div>9</div>
                        <input name="system.diceroller.damage.reroll.nine" type="checkbox" {{checked
                            system.diceroller.damage.reroll.nine}}>
                    </div>
                    <div>
                        <div>10</div>
                        <input name="system.diceroller.damage.reroll.ten" type="checkbox" {{checked
                            system.diceroller.damage.reroll.ten}}>
                    </div>
                </div>
                <div class="resource flex-center">
                    <label class="resource-label">{{localize "Ex3.RerollsCap"}}*</label>
                </div>
                <div class="resource d-flex flex-center mb-1">
                    <div class="resource d-flex flex-center">
                        <div>
                            <div>1</div>
                            <input name="system.diceroller.damage.rerollcap.one"
                                value="{{system.diceroller.damage.rerollcap.one}}" type="text">
                        </div>
                        <div>
                            <div>2</div>
                            <input name="system.diceroller.damage.rerollcap.two"
                                value="{{system.diceroller.damage.rerollcap.two}}" type="text">
                        </div>
                        <div>
                            <div>3</div>
                            <input name="system.diceroller.damage.rerollcap.three"
                                value="{{system.diceroller.damage.rerollcap.three}}" type="text">
                        </div>
                        <div>
                            <div>4</div>
                            <input name="system.diceroller.damage.rerollcap.four"
                                value="{{system.diceroller.damage.rerollcap.four}}" type="text">
                        </div>
                        <div>
                            <div>5</div>
                            <input name="system.diceroller.damage.rerollcap.five"
                                value="{{system.diceroller.damage.rerollcap.five}}" type="text">
                        </div>
                        <div>
                            <div>6</div>
                            <input name="system.diceroller.damage.rerollcap.six"
                                value="{{system.diceroller.damage.rerollcap.six}}" type="text">
                        </div>
                        <div>
                            <div>7</div>
                            <input name="system.diceroller.damage.rerollcap.seven"
                                value="{{system.diceroller.damage.rerollcap.seven}}" type="text">
                        </div>
                        <div>
                            <div>8</div>
                            <input name="system.diceroller.damage.rerollcap.eight"
                                value="{{system.diceroller.damage.rerollcap.eight}}" type="text">
                        </div>
                        <div>
                            <div>9</div>
                            <input name="system.diceroller.damage.rerollcap.nine"
                                value="{{system.diceroller.damage.rerollcap.nine}}" type="text">
                        </div>
                        <div>
                            <div>10</div>
                            <input name="system.diceroller.damage.rerollcap.ten"
                                value="{{system.diceroller.damage.rerollcap.ten}}" type="text">
                        </div>
                    </div>
                </div>
                <div class="resource flex-center">
                    <label class="resource-label">{{localize "Ex3.DoubleSuccessCap"}}*</label>
                </div>
                <div class="resource grid grid-4col flex-center">
                    <div>
                        <label class="resource-label">{{localize "Ex3.Sevens"}}</label>
                        <input name="system.diceroller.damage.doublesucccesscaps.sevens"
                            value="{{system.diceroller.damage.doublesucccesscaps.sevens}}" type="text">
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.Eights"}}</label>
                        <input name="system.diceroller.damage.doublesucccesscaps.eights"
                            value="{{system.diceroller.damage.doublesucccesscaps.eights}}" type="text">
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.Nines"}}</label>
                        <input name="system.diceroller.damage.doublesucccesscaps.nines"
                            value="{{system.diceroller.damage.doublesucccesscaps.nines}}" type="text">
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.Tens"}}</label>
                        <input name="system.diceroller.damage.doublesucccesscaps.tens"
                            value="{{system.diceroller.damage.doublesucccesscaps.tens}}" type="text">
                    </div>
                </div>
                <div class="resource grid grid-2col flex-center">
                    <div>
                        <div class="resource-label">{{localize "Ex3.TriggerOnTens"}}</div>
                        <select name="system.diceroller.damage.triggerontens" data-type="String">
                            {{selectOptions selects.triggerOnTensDamageOptions
                            selected=system.diceroller.damage.triggerontens localize=true}}
                        </select>
                    </div>
                    <div>
                        <div class="resource-label">{{localize "Ex3.TriggerTensCap"}}*</div>
                        <input name="system.diceroller.damage.triggertenscap"
                            value="{{system.diceroller.damage.triggertenscap}}" type="text">
                    </div>
                    <div>
                        <div class="resource-label">{{localize "Ex3.AlsoTriggerNines"}}</div>
                        <input name="system.diceroller.damage.alsotriggernines" type="checkbox" {{checked
                            system.diceroller.damage.alsotriggernines}}>
                    </div>
                    <div>
                        <div class="resource-label">{{localize "Ex3.ExcludeOnesFromRerolls"}}</div>
                        <input name="system.diceroller.damage.excludeonesfromrerolls" type="checkbox" {{checked
                            system.diceroller.damage.excludeonesfromrerolls}}>
                    </div>
                </div>
            </div>
            <div class="flex-center resource-label" style="font-weight: bold;font-size:17px;">
                {{localize "Ex3.OtherBonuses"}}
            </div>
            <div class="resource grid grid-2col flex-center">
                <div>
                    <label class="resource-label">{{localize "Ex3.SelfDefensePenalty"}}</label>
                    <input name="system.diceroller.selfdefensepenalty" value="{{system.diceroller.selfdefensepenalty}}"
                        type="number">
                </div>
                <div>
                    <label class="resource-label">{{localize "Ex3.TargetDefensePenalty"}}</label>
                    <input name="system.diceroller.targetdefensepenalty"
                        value="{{system.diceroller.targetdefensepenalty}}" type="number">
                </div>
                <div>
                    <div class="resource-label">{{localize "Ex3.ActivateAura"}}</div>
                    <select name="system.diceroller.activateAura" data-type="String">
                        {{selectOptions selects.elements selected=system.diceroller.activateAura localize=true}}
                    </select>
                </div>
                <div>
                    <div class="resource-label">{{localize "Ex3.IgnoreLegendarySize"}}</div>
                    <input name="system.diceroller.ignorelegendarysize" type="checkbox" {{checked
                        system.diceroller.ignorelegendarysize}}>
                </div>
            </div>
            <hr>
            <div class="d-flex flex-center resource-label" style="font-weight: bold;font-size: 17px;">
                <div>
                    {{localize "Ex3.OpposedBonuses"}}
                </div>
                <input name="system.diceroller.opposedbonuses.enabled" type="checkbox" {{checked
                    system.diceroller.opposedbonuses.enabled}}>
            </div>
            <div>
                <div class="resource grid grid-3col flex-center">
                    <div>
                        <label class="resource-label">{{localize "Ex3.DiceModifier"}}*</label>
                        <input name="system.diceroller.opposedbonuses.dicemodifier"
                            value="{{system.diceroller.opposedbonuses.dicemodifier}}" type="text">
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.SuccessModifier"}}*</label>
                        <input name="system.diceroller.opposedbonuses.successmodifier"
                            value="{{system.diceroller.opposedbonuses.successmodifier}}" type="text">
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.PenaltyModifier"}}*</label>
                        <input name="system.diceroller.opposedbonuses.penaltymodifier"
                            value="{{system.diceroller.opposedbonuses.penaltymodifier}}" type="text">
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.RerollSuccesses"}}*</label>
                        <input name="system.diceroller.opposedbonuses.rerollsuccesses"
                            value="{{system.diceroller.opposedbonuses.rerollsuccesses}}" type="text">
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.Resolve"}}*</label>
                        <input name="system.diceroller.opposedbonuses.resolve"
                            value="{{system.diceroller.opposedbonuses.resolve}}" type="text">
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.Guile"}}*</label>
                        <input name="system.diceroller.opposedbonuses.guile"
                            value="{{system.diceroller.opposedbonuses.guile}}" type="text">
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.IncreaseTargetNumber"}}</label>
                        <input name="system.diceroller.opposedbonuses.increasetargetnumber"
                            value="{{system.diceroller.opposedbonuses.increasetargetnumber}}" type="number">
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.Defense"}}*</label>
                        <input name="system.diceroller.opposedbonuses.defense"
                            value="{{system.diceroller.opposedbonuses.defense}}" type="text">
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.Soak"}}*</label>
                        <input name="system.diceroller.opposedbonuses.soak"
                            value="{{system.diceroller.opposedbonuses.soak}}" type="text">
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.Hardness"}}*</label>
                        <input name="system.diceroller.opposedbonuses.hardness"
                            value="{{system.diceroller.opposedbonuses.hardness}}" type="text">
                    </div>
                    {{#if useShieldInitiative}}
                    <div>
                        <label class="resource-label">{{localize "Ex3.ShieldInitiative"}}*</label>
                        <input name="system.diceroller.opposedbonuses.shieldinitiative"
                            value="{{system.diceroller.opposedbonuses.shieldinitiative}}" type="text">
                    </div>
                    {{/if}}
                    <div>
                        <label class="resource-label">{{localize "Ex3.DamageModifier"}}*</label>
                        <input name="system.diceroller.opposedbonuses.damagemodifier"
                            value="{{system.diceroller.opposedbonuses.damagemodifier}}" type="text">
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.IncreaseDamageTN"}}</label>
                        <input name="system.diceroller.opposedbonuses.increasedamagetargetnumber"
                            value="{{system.diceroller.opposedbonuses.increasedamagetargetnumber}}" type="number">
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.IncreaseGambitDifficulty"}}*</label>
                        <input name="system.diceroller.opposedbonuses.increasegambitdifficulty"
                            value="{{system.diceroller.opposedbonuses.increasegambitdifficulty}}" type="text">
                    </div>
                </div>
                <div class="resource grid grid-2col flex-center" style="padding-bottom:20px;">
                    <div>
                        <div class="resource-label">{{localize "Ex3.TriggerOnOnes"}}</div>
                        <select name="system.diceroller.opposedbonuses.triggeronones" data-type="String">
                            {{selectOptions selects.triggerOnOnesOptions
                            selected=system.diceroller.opposedbonuses.triggeronones localize=true}}
                        </select>
                    </div>
                    <div>
                        <label class="resource-label">{{localize "Ex3.TriggerOnesCap"}}*</label>
                        <input name="system.diceroller.opposedbonuses.triggeronescap"
                            value="{{system.diceroller.opposedbonuses.triggeronescap}}" type="text">
                    </div>
                    <div>
                        <div class="resource-label">{{localize "Ex3.AlsoTriggerTwos"}}</div>
                        <input name="system.diceroller.opposedbonuses.alsotriggertwos" type="checkbox" {{checked
                            system.diceroller.opposedbonuses.alsotriggertwos}}>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab" data-group="primary" data-tab="automations">
            {{> systems/exaltedthird/templates/item/item-trigger-tab.html}}
            {{> systems/exaltedthird/templates/actor/active-effects.html}}
        </div>

        <div class="tab" data-group="primary" data-tab="upgrades">
            <div class="resource flex-center mb-1" style="font-size: 17px;"><label class="resource-label">{{localize
                    "Ex3.Upgrades"}} <a class="item-control add-upgrade" title="Create upgrade"><i
                            class="fas fa-plus"></i></a></label>
            </div>
            {{#each system.upgrades as |upgrade index|}}
            <div class="flex-group-center mb-1">
                <div class="grid grid-2col flex-center">
                    <div>
                        <div>
                            <label class="resource-label">{{localize "Ex3.Name"}}</label>
                        </div>
                        <div class="d-flex" style="align-items:center; margin-bottom: 10px;">
                            <input name="system.upgrades.{{index}}.name" class="upgrade-name" value="{{upgrade.name}}"
                                type="text" data-index="{{index}}">
                        </div>
                    </div>
                    <div>
                        <div style="margin-right: 42px;">
                            <label class="resource-label">{{localize "Ex3.Active"}}</label>
                        </div>
                        <div class="d-flex" style="align-items:center; margin-bottom: 10px;justify-content:center;">
                            <input name="system.upgrades.{{index}}.active" type="checkbox" {{checked upgrade.active}}>
                            <a class="item-control delete-upgrade" title="Delete upgrade" data-index="{{index}}"><i
                                    class="fas fa-trash" style="margin-right: 15px; margin-left:15px;"></i></a>
                        </div> 
                    </div>
                </div>
            </div>
            {{/each}}
            <div class="resource flex-center mb-1" style="font-size: 17px;"><label class="resource-label">{{localize
                    "Ex3.Modes"}} <a class="item-control edit-alternate-mode" title="Create alternate" data-function="add"><i
                            class="fas fa-plus"></i></a></label>
            </div>
            <div  class="flex-center d-flex mb-1">
                <label class="resource-label" style="width:25%;">{{localize "Ex3.MainMode"}}: </label>
                <input type="text" name="system.modes.mainmode.name" value="{{system.modes.mainmode.name}}" placeholder="{{item.name}}" />
            </div>
            {{#each system.modes.alternates as |alternate index|}}            
            <div class="item large-item">
                <div class="item-text gap">
                    <div class="item-image"><img class="list-item-image" src="{{../item.img}}" title="{{alternate.name}}"
                            width="35" height="35" /></div>
                    <span class="item-name">{{alternate.name}}</span>
                    <span class="text-summary">{{alternate.summary}}</span>
                </div>
                <div class="item-controls" data-item-index="{{index}}">
                    <a class="item-alternate edit-alternate-mode"
                        title="Edit Alternate" data-item-index="{{index}}" data-function="edit"><i class="fas fa-edit"></i></a>
                    <a class="item-alternate delete-alternate"
                        title="Remove Alternate" data-item-index="{{index}}"><i class="fas fa-trash"></i></a>
                </div>
            </div>
            {{/each}}
        </div>

        <div id="other-tab" class="tab" data-group="primary" data-tab="other">
            <div class="flex-group-center">
                <label class="resource-label">{{localize "Ex3.Summary"}}</label>
                <textarea type="text" name="system.summary" rows="4">{{system.summary}}</textarea>
            </div>
            <div class="grid grid-2col flex-group-center">
                <div>
                    <div class="resource-label">{{localize "Ex3.CharmType"}}</div>
                    <select name="system.charmtype" data-type="String">
                        {{selectOptions charmExaltType selected=system.charmtype localize=true}}
                    </select>
                </div>
                <div>
                    <div class="flex-center">
                        <div class="resource-label">{{localize "Ex3.CostDisplay"}}</div>
                    </div>
                    <input type="text" name="system.costdisplay" value="{{system.costdisplay}}" />
                </div>
                <div>
                    <div class="flex-center">
                        <div class="resource-label">{{localize "Ex3.ListingName"}}</div>
                    </div>
                    <input type="text" name="system.listingname" value="{{system.listingname}}"
                        placeholder="Defaults to ability name" />
                </div>
                <div>
                    <div class="resource-label">{{localize "Ex3.EndTrigger"}}</div>
                    <select name="system.endtrigger" data-type="String">
                        {{selectOptions selects.endTriggers selected=system.endtrigger localize=true}}
                    </select>
                </div>
                <div>
                    <div class="resource-label">{{localize "Ex3.AutoAddToRolls"}}</div>
                    <select name="system.autoaddtorolls" data-type="String">
                        {{selectOptions selects.autoAddToRollOptions selected=system.autoaddtorolls localize=true}}
                    </select>
                </div>
                <div>
                    <label class="resource-label">{{localize "Ex3.Activatable"}}</label>
                    <div>
                        <input name="system.activatable" type="checkbox" {{checked system.activatable}}>
                    </div>
                </div>
                <div>
                    <div class="resource-label">{{localize "Ex3.MultiActivate"}}</div>
                    <input type="checkbox" name="system.multiactivate" {{checked system.multiactivate}} />
                </div>
            </div>
            <div class="d-flex flex-center resource-label">
                <div class="resource-label">{{localize "Ex3.PreviousCharmsPrerequisites"}}</div>
            </div>
            <div class="resource-content flexrow flex-center">
                <input placeholder="Previous Charms from: " type="number" name="system.numberprerequisites.number"
                    value="{{system.numberprerequisites.number}}" />
                <select name="system.numberprerequisites.ability" data-type="String">
                    {{#each charmAbilityListSectioned as |charmCategory charmCategoryType|}}
                    <optgroup label="{{localize charmCategory.label}}">
                        {{selectOptions charmCategory.entries selected=../system.numberprerequisites.ability
                        localize=true}}
                    </optgroup>
                    {{/each}}
                    {{selectOptions selects.previousCharmsPrerequisitesOptions
                    selected=system.numberprerequisites.ability localize=true}}
                </select>
            </div>
            <div class="d-flex flex-center resource-label">
                <div class="resource-label">{{localize "Ex3.AlternatePrerequisites"}}</div>
            </div>
            <div>
                <label class="resource-label">{{localize "Ex3.Ability"}}: </label>
                <select name="system.archetype.ability" data-type="String">
                    {{#each charmAbilityListSectioned as |charmCategory charmCategoryType|}}
                    <optgroup label="{{localize charmCategory.label}}">
                        {{selectOptions charmCategory.entries selected=../system.archetype.ability localize=true}}
                    </optgroup>
                    {{/each}}
                    {{selectOptions selects.uniqueArchetypeAbilityOptions selected=system.archetype.ability
                    localize=true}}
                </select>
            </div>
            <div class="flex-center mt-1">
                <div class="resource-label">{{localize "Ex3.CharmPrerequisites"}}</div>
            </div>
            <div class="embeded-item-list-wrapper" {{#if
                options.editable}}style="border: 1px solid var(--color-border-light-tertiary);" {{/if}}>
                <div class="flex-group-center embeded-item-list">
                    <ul>
                        {{#if options.editable}}
                        {{#each system.archetype.charmprerequisites as |item id|}}
                        <a draggable="true" class="embeded-item-pill" data-id="{{item.id}}"
                            data-item-name="{{item.name}}" data-item-index="{{id}}" data-type="archetype">
                            <li data-item-index="{{id}}">
                                {{item.name}} {{#ifGreater item.count 1}}x{{item.count}}{{/ifGreater}}
                                <i data-type="archetype" class="fas fa-trash embeded-item-delete"></i>
                            </li>
                        </a>
                        {{/each}}
                        {{else}}
                        {{#each system.archetype.charmprerequisites as |item id|}}
                        <li class="embeded-item-pill" data-item-name="{{../name}}" data-item-index="{{id}}"
                            data-type="archetype">
                            {{item.name}}
                        </li>
                        {{/each}}
                        {{/if}}
                    </ul>
                </div>
            </div>
            <div class="flex-center mt-1">
                <div class="resource-label">{{localize "Ex3.OtherPrerequisites"}}</div>
            </div>
            <textarea type="text" name="system.archetype.prerequisites"
                rows="4">{{system.archetype.prerequisites}}</textarea>
            {{#if showParentItemList}}
            <div>
                {{#ifEquals system.ability 'evocation'}}
                <div class="flex-center">
                    <div class="resource-label">{{localize "Ex3.Artifact"}}</div>
                </div>
                {{else}}
                <div class="flex-center">
                    <div class="resource-label">{{localize "Ex3.MartialArt"}}</div>
                </div>
                {{/ifEquals}}
                <select name="system.parentitemid" data-type="String">
                    {{selectOptions parentItemList selected=system.parentitemid localize=true}}
                </select>
            </div>
            {{/if}}
        </div>

    </section>
</form>